// ../public/assets/js/lang.js

// 1. Diccionario de textos
window.APP_I18N = {
  es: {
    // Menú
    "menu.home": "Inicio",
    "menu.services": "Servicios a Empresas",
    "menu.about": "Quiénes Somos",
    "menu.products": "Productos",
    "menu.certs": "Certificaciones",
    "menu.quality": "Calidad",
    "menu.calendar": "Calendario Varietal",
    "menu.contact": "Contacto y Ubicación",
    "menu.gallery": "Galeria",

    // UI selector idioma
    "ui.lang.es": "Español",
    "ui.lang.en": "Inglés",
    "ui.lang.nl": "Neerlandés",

    // Hero / títulos
    "hero.products": "Productos",
    "hero.calTitle": "Calendario varietal",

    "products.title": "PRODUCTOS",
    "intro.calTitle": "Disponibilidad por temporada",
    "intro.calText":
      "Referencia general por cultivo y mes. Los rangos pueden variar según clima, zonas productoras y ventanas de exportación. Para programas específicos, contáctanos.",

    // Calendario - encabezados
    "cal.header.product": "Producto",
    "cal.header.jan": "Ene",
    "cal.header.feb": "Feb",
    "cal.header.mar": "Mar",
    "cal.header.apr": "Abr",
    "cal.header.may": "May",
    "cal.header.jun": "Jun",
    "cal.header.jul": "Jul",
    "cal.header.aug": "Ago",
    "cal.header.sep": "Sep",
    "cal.header.oct": "Oct",
    "cal.header.nov": "Nov",
    "cal.header.dec": "Dic",

    // Calendario - leyenda
    "cal.legend.hi": "Alta (A)",
    "cal.legend.mid": "Media (M)",
    "cal.legend.low": "Baja (B)",
    "cal.legend.off": "Sin temporada",

    // Notas
    "notes.title": "Notas",
    "notes.item1":
      "Las ventanas pueden cambiar según variedades, zonas y requisitos fitosanitarios del país destino.",
    "notes.item2":
      "Verifica los meses exactos del programa en Productos o solicita una actualización en Contacto.",

    // Footer
    "footer.rights": "Todos los derechos reservados",
    "footer.brand": "Oml America © 2016 | Diseño Web |",
    "footer.newsTitle": "¡Mantente informado!",
    "footer.products": "Productos",
    "footer.about": "Sobre Nosotros",
    "footer.aboutUs": "Quiénes Somos",
    "footer.services": "Servicios",
    "footer.certs": "Certificaciones",
    "footer.quality": "Calidad",
    "footer.contact": "Contacto",
    "footer.contactTitle": "Contacto"
  },

  en: {
    // Menu
    "menu.home": "Home",
    "menu.services": "Services for Companies",
    "menu.about": "About Us",
    "menu.products": "Products",
    "menu.certs": "Certifications",
    "menu.quality": "Quality",
    "menu.calendar": "Varietal Calendar",
    "menu.contact": "Contact & Location",
    "menu.gallery": "Gallery",

    // UI selector idioma
    "ui.lang.es": "Spanish",
    "ui.lang.en": "English",
    "ui.lang.nl": "Dutch",

    // Hero / títulos
    "hero.products": "Products",
    "hero.calTitle": "Varietal calendar",

    "products.title": "PRODUCTS",
    "intro.calTitle": "Availability by season",
    "intro.calText":
      "General reference by crop and month. Ranges may vary according to climate, producing areas and export windows. For specific programs, contact us.",

    // Calendario - encabezados
    "cal.header.product": "Product",
    "cal.header.jan": "Jan",
    "cal.header.feb": "Feb",
    "cal.header.mar": "Mar",
    "cal.header.apr": "Apr",
    "cal.header.may": "May",
    "cal.header.jun": "Jun",
    "cal.header.jul": "Jul",
    "cal.header.aug": "Aug",
    "cal.header.sep": "Sep",
    "cal.header.oct": "Oct",
    "cal.header.nov": "Nov",
    "cal.header.dec": "Dec",

    // Calendario - leyenda
    "cal.legend.hi": "High (A)",
    "cal.legend.mid": "Medium (M)",
    "cal.legend.low": "Low (B)",
    "cal.legend.off": "No season",

    // Notas
    "notes.title": "Notes",
    "notes.item1":
      "Windows may change depending on varieties, regions and phytosanitary requirements of the destination country.",
    "notes.item2":
      "Check the exact months of the program in Products or request an update in Contact.",

    // Footer
    "footer.rights": "All rights reserved",
    "footer.brand": "Oml America © 2016 | Web Design |",
    "footer.newsTitle": "Stay informed!",
    "footer.products": "Products",
    "footer.about": "About us",
    "footer.aboutUs": "About us",
    "footer.services": "Services",
    "footer.certs": "Certifications",
    "footer.quality": "Quality",
    "footer.contact": "Contact",
    "footer.contactTitle": "Contact"
  },

  nl: {
    // Menu
    "menu.home": "Start",
    "menu.services": "Diensten voor bedrijven",
    "menu.about": "Over ons",
    "menu.products": "Producten",
    "menu.certs": "Certificeringen",
    "menu.quality": "Kwaliteit",
    "menu.calendar": "Raskalender",
    "menu.contact": "Contact & locatie",
    "menu.gallery": "Galerij",

    // UI selector idioma
    "ui.lang.es": "Spaans",
    "ui.lang.en": "Engels",
    "ui.lang.nl": "Nederlands",

    // Hero / títulos
    "hero.products": "Producten",
    "hero.calTitle": "Raskalender",

    "products.title": "PRODUCTEN",
    "intro.calTitle": "Beschikbaarheid per seizoen",
    "intro.calText":
      "Algemene referentie per gewas en maand. De periodes kunnen variëren afhankelijk van klimaat, teeltgebieden en exportvensters. Voor specifieke programma's, neem contact met ons op.",

    // Calendario - encabezados
    "cal.header.product": "Product",
    "cal.header.jan": "Jan",
    "cal.header.feb": "Feb",
    "cal.header.mar": "Mrt",
    "cal.header.apr": "Apr",
    "cal.header.may": "Mei",
    "cal.header.jun": "Jun",
    "cal.header.jul": "Jul",
    "cal.header.aug": "Aug",
    "cal.header.sep": "Sep",
    "cal.header.oct": "Okt",
    "cal.header.nov": "Nov",
    "cal.header.dec": "Dec",

    // Calendario - leyenda
    "cal.legend.hi": "Hoog (A)",
    "cal.legend.mid": "Midden (M)",
    "cal.legend.low": "Laag (B)",
    "cal.legend.off": "Geen seizoen",

    // Notas
    "notes.title": "Notities",
    "notes.item1":
      "De vensters kunnen veranderen afhankelijk van rassen, regio's en fytosanitaire eisen van het bestemmingsland.",
    "notes.item2":
      "Controleer de exacte maanden van het programma bij Producten of vraag een update aan bij Contact.",

    // Footer
    "footer.rights": "Alle rechten voorbehouden",
    "footer.brand": "Oml America © 2016 | Webdesign |",
    "footer.newsTitle": "Blijf op de hoogte!",
    "footer.products": "Producten",
    "footer.about": "Over ons",
    "footer.aboutUs": "Over ons",
    "footer.services": "Diensten",
    "footer.certs": "Certificeringen",
    "footer.quality": "Kwaliteit",
    "footer.contact": "Contact",
    "footer.contactTitle": "Contact"
  }
};

// 2. Lógica de selector + persistencia entre páginas
(function () {
  const STORAGE_KEY = "siteLang";
  const SUPPORTED = ["es", "en", "nl"];
  const DEFAULT_LANG = "es";

  // --- desktop (sidebar) ---
  const desktopSwitcher = document.querySelector("[data-lang-switcher]");
  const desktopBtn = desktopSwitcher?.querySelector(".lang-current");
  const desktopMenu = desktopSwitcher?.querySelector(".lang-menu");
  const desktopItems = desktopMenu
    ? Array.from(desktopMenu.querySelectorAll("[data-lang-option]"))
    : [];

  // --- botones dentro del drawer (móvil / tablet) ---
  const drawerButtons = Array.from(
    document.querySelectorAll(".drawer-lang-btn[data-lang-option]")
  );

  // abrir / cerrar dropdown desktop
  if (desktopSwitcher && desktopBtn && desktopMenu) {
    desktopBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      desktopSwitcher.classList.toggle("open");
    });

    document.addEventListener("click", (e) => {
      if (!desktopSwitcher.contains(e.target)) {
        desktopSwitcher.classList.remove("open");
      }
    });
  }

  function setLang(lang) {
    if (!SUPPORTED.includes(lang)) lang = DEFAULT_LANG;

    // atributo en html
    document.documentElement.setAttribute("data-lang", lang);
    document.documentElement.lang = lang;

    try {
      localStorage.setItem(STORAGE_KEY, lang);
    } catch (e) {}

    // --- actualizar selector desktop ---
    if (desktopSwitcher && desktopBtn && desktopMenu) {
      const currentItem = desktopMenu.querySelector(
        `[data-lang-option="${lang}"]`
      );
      const labelEl = desktopBtn.querySelector(".lang-label");
      const flagEl = desktopBtn.querySelector(".flag");

      if (currentItem && labelEl && flagEl) {
        const itemFlag = currentItem.querySelector(".flag");
        const itemText = currentItem.querySelector("span:nth-child(2)");

        if (itemFlag) {
          const flagClass = Array.from(itemFlag.classList).find((c) =>
            c.startsWith("flag-")
          );
          flagEl.className = "flag " + flagClass;
        }
        if (itemText) {
          labelEl.textContent = itemText.textContent;
        }
      }

      // solo mostrar los OTROS idiomas en el menú
      desktopItems.forEach((it) => {
        it.style.display =
          it.dataset.langOption === lang ? "none" : "flex";
      });

      desktopSwitcher.classList.remove("open");
    }

    // --- actualizar barra de idiomas del drawer ---
    drawerButtons.forEach((btn) => {
      btn.classList.toggle("active", btn.dataset.langOption === lang);
    });

    // --- aplicar traducciones ---
    applyTranslations(lang);
  }

  function applyTranslations(lang) {
    const dict = window.APP_I18N && window.APP_I18N[lang];
    if (!dict) return;

    document.querySelectorAll("[data-i18n]").forEach((el) => {
      const key = el.dataset.i18n;
      const value = dict[key];
      if (!value) return;

      // si dentro hay enlaces, dejamos el HTML y solo cambiamos texto base en casos simples
      if (el.tagName === "INPUT" || el.tagName === "TEXTAREA") {
        el.placeholder = value;
      } else {
        // si tiene hijos con <a>, puedes ajustar según lo que necesites;
        // por ahora reemplazamos texto completo
        el.textContent = value;
      }
    });
  }

  function onLangSelect(lang) {
    setLang(lang);
  }

  // clic en opciones del menú desktop
  desktopItems.forEach((item) => {
    item.addEventListener("click", () => {
      const lang = item.dataset.langOption;
      onLangSelect(lang);
    });
  });

  // clic en botones del drawer
  drawerButtons.forEach((btn) => {
    btn.addEventListener("click", () => {
      const lang = btn.dataset.langOption;
      onLangSelect(lang);
    });
  });

  // idioma inicial (se mantiene entre páginas)
  let saved = null;
  try {
    saved = localStorage.getItem(STORAGE_KEY);
  } catch (e) {
    saved = null;
  }
  const initial = SUPPORTED.includes(saved) ? saved : DEFAULT_LANG;
  setLang(initial);
})();
